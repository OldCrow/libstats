# LibStats v1.0.0 Release Roadmap - Final Plan

**Document Version:** 1.0  
**Created:** 2025-08-19  
**Target Release:** v1.0.0  
**Current Status:** Post cache infrastructure removal  
**Estimated Timeline:** 5-7 weeks to v1.0.0

---

## üéØ Executive Summary

This roadmap presents the streamlined path to v1.0.0 after abandoning the complex cache architecture work. We focus on high-value improvements that provide clear benefits without unnecessary complexity.

### Key Strategic Changes
- ‚úÖ **Cache work abandoned**: ThreadSafeCacheManager provides sufficient caching
- ‚úÖ **Timeline shortened**: 5-7 weeks instead of 8-11 weeks  
- ‚úÖ **Risk reduced**: Removed medium-high risk cache architecture work
- ‚úÖ **Focus sharpened**: Header optimization, code consolidation, and quality improvements

### Deliverables by v1.0.0
- üì¶ **20-35% faster compilation** via header optimization
- üèóÔ∏è **70% code reduction** (~5,600 lines) via template consolidation
- ‚ö° **Optimized mathematical functions** with documented algorithms
- üîß **Complete CI/CD pipeline** with multi-platform validation
- üìö **Production-ready API** with proper symbol exports
- ‚úÖ **Cross-compiler clean builds** with zero warnings

---

## üìÖ Release Timeline

| Version | Duration | Focus | Risk Level | Status |
|---------|----------|-------|------------|--------|
| **v0.9.1** | ‚úÖ Complete | Critical performance fixes | Low | ‚úÖ Done |
| **v0.9.1.5** | 3-4 days | CI/CD & Development Infrastructure | Low | ‚úÖ Complete |
| **v0.9.2** | 1-2 weeks | Header Optimization | Low-Medium | üöÄ Next |
| **v0.9.3** | 2-3 weeks | Distribution Code Refactoring | Medium | Pending |
| **v0.9.4** | 1-1.5 weeks | Mathematical Optimization & Polish | Low | Pending |
| **v1.0.0** | 1 week | Release Candidate & API Finalization | Low | Pending |

**Total Timeline**: 5-7 weeks to v1.0.0

---

## üöÄ v0.9.1.5 - CI/CD & Development Infrastructure (3-4 days)

### **Objective**
Establish robust development infrastructure BEFORE major refactoring to catch issues early and maintain quality throughout.

### **Task 1: Core CI/CD Setup**

#### GitHub Actions Workflow
Create `.github/workflows/ci.yml`:
```yaml
name: CI

on:
  push:
    branches: [ main, develop, 'release/*' ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest, windows-latest]
        compiler: 
          - { cc: gcc-11, cxx: g++-11 }
          - { cc: gcc-12, cxx: g++-12 }
          - { cc: clang-14, cxx: clang++-14 }
          - { cc: clang-15, cxx: clang++-15 }
        build_type: [Debug, Release]
        exclude:
          - os: windows-latest
            compiler: { cc: gcc-11, cxx: g++-11 }
          - os: windows-latest
            compiler: { cc: gcc-12, cxx: g++-12 }
            
    runs-on: ${{ matrix.os }}
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup compiler
      run: |
        echo "CC=${{ matrix.compiler.cc }}" >> $GITHUB_ENV
        echo "CXX=${{ matrix.compiler.cxx }}" >> $GITHUB_ENV
    
    - name: Configure CMake
      run: cmake -B build -DCMAKE_BUILD_TYPE=${{ matrix.build_type }}
      
    - name: Build
      run: cmake --build build --config ${{ matrix.build_type }} --parallel
      
    - name: Test
      run: ctest -C ${{ matrix.build_type }} --test-dir build --output-on-failure --parallel
      
    - name: Benchmark (Release only)
      if: matrix.build_type == 'Release'
      run: |
        ./build/tools/system_inspector --performance
        ./build/examples/gaussian_performance_benchmark
```

#### Checklist:
- [x] Create GitHub Actions workflow with multi-platform matrix
- [x] Configure compiler matrix (GCC 11/12, Clang 14/15, MSVC)
- [x] Add test execution with parallel support
- [x] Add benchmark execution for release builds
- [x] Configure code coverage with codecov.io or similar
- [x] Add build status badges to README

### **Task 2: Code Quality Tools**

#### Linting Configuration
Create `.clang-format`:
```yaml
BasedOnStyle: Google
IndentWidth: 4
ColumnLimit: 100
NamespaceIndentation: None
AlignAfterOpenBracket: Align
AllowShortFunctionsOnASingleLine: Inline
```

Create `.clang-tidy`:
```yaml
Checks: >
  -*,
  bugprone-*,
  clang-analyzer-*,
  modernize-*,
  performance-*,
  readability-*,
  -modernize-use-trailing-return-type,
  -readability-magic-numbers

WarningsAsErrors: ''
HeaderFilterRegex: '.*'
```

#### Checklist:
- [x] Configure clang-format with project style guide
- [x] Setup clang-tidy with appropriate checks
- [x] Add cppcheck configuration
- [ ] Configure include-what-you-use (IWYU)
- [ ] Create pre-commit hooks for local validation
- [x] Add format checking to CI pipeline

### **Task 3: Documentation & Packaging**

#### Checklist:
- [ ] Configure Doxygen generation in CI
- [ ] Setup GitHub Pages deployment for documentation
- [x] Add CMake package installation validation
- [ ] Create pkg-config file generation
- [ ] Setup semantic versioning automation
- [ ] Configure changelog generation from commits

---

## üì¶ v0.9.2 - Header Optimization (1-2 weeks)

### **Objective**
Achieve 20-35% compilation time improvement through systematic header optimization and PIMPL conversions.

### **Task 1: Standard Library Include Standardization (2-3 hours)**

#### Issues to Address:
- Gaussian uses potentially unused C++20 headers (`<ranges>`, `<concepts>`, `<version>`)
- Distributions have inconsistent standard library includes
- All distributions duplicate threading includes

#### Checklist:
- [ ] Create `include/core/distribution_stdlib_common.h` for shared includes
- [ ] Remove unused C++20 headers from Gaussian
- [ ] Standardize includes across all 6 distributions
- [ ] Measure compilation time improvement

### **Task 2: PIMPL Implementation for Core Files (1 week)**

#### Phase 1: SIMD Implementation Files (Low Risk)
Convert files using `platform/platform_constants.h` to forward declarations:
- [ ] `src/simd_fallback.cpp` ‚Üí use `platform_constants_fwd.h`
- [ ] `src/simd_sse2.cpp` ‚Üí use forward declarations
- [ ] `src/simd_avx.cpp` ‚Üí use forward declarations
- [ ] `src/simd_avx2.cpp` ‚Üí use forward declarations
- [ ] `src/simd_avx512.cpp` ‚Üí use forward declarations
- [ ] `src/simd_neon.cpp` ‚Üí use forward declarations
- [ ] `src/simd_dispatch.cpp` ‚Üí use forward declarations

#### Phase 2: Threading Infrastructure (Low Risk)
- [ ] `src/thread_pool.cpp` ‚Üí use forward declarations
- [ ] `src/work_stealing_pool.cpp` ‚Üí use forward declarations
- [ ] `src/cpu_detection.cpp` ‚Üí use forward declarations

#### Phase 3: Distribution Core (Medium Risk)
Convert distribution files using `platform/parallel_execution.h`:
- [ ] `src/distribution_base.cpp` ‚Üí use `parallel_execution_fwd.h`
- [ ] `src/gaussian.cpp` ‚Üí use forward declarations
- [ ] `src/exponential.cpp` ‚Üí use forward declarations
- [ ] `src/uniform.cpp` ‚Üí use forward declarations
- [ ] `src/poisson.cpp` ‚Üí use forward declarations
- [ ] `src/discrete.cpp` ‚Üí use forward declarations
- [ ] `src/gamma.cpp` ‚Üí use forward declarations

#### Phase 4: Core Headers (Medium-High Risk)
- [ ] `include/core/distribution_base.h` ‚Üí use forward declarations
- [ ] `include/core/constants.h` ‚Üí use forward declarations
- [ ] `include/distributions/distribution_platform_common.h` ‚Üí use forward declarations

### **Success Metrics:**
- [ ] 20-35% reduction in compilation time
- [ ] No functionality regression
- [ ] All tests pass

---

## üèóÔ∏è v0.9.3 - Distribution Code Refactoring (2-3 weeks)

### **Objective**
Achieve 70% code reduction (~5,600 lines) through template-based consolidation.

### **Task 1: Stream Operators Template (~150 lines saved)**

Create `include/core/distribution_stream_operators.h`:
```cpp
template<typename Derived>
class StreamOperatorsMixin {
public:
    friend std::ostream& operator<<(std::ostream& os, const Derived& dist) {
        return os << Derived::getDistributionName() << "(" 
                  << dist.getParametersString() << ")";
    }
};
```

#### Checklist:
- [ ] Create stream operators template mixin
- [ ] Apply to all 6 distributions
- [ ] Remove duplicate operator code

### **Task 2: Safe Factory Pattern Template (~250 lines saved)**

Create `include/core/distribution_factory.h`:
```cpp
template<typename Derived, typename... ParameterTypes>
class DistributionFactory {
public:
    template<typename... Args>
    [[nodiscard]] static Result<Derived> create(Args&&... args) noexcept {
        if (!Derived::validateParameters(args...)) {
            return Result<Derived>::failure("Invalid parameters");
        }
        try {
            return Result<Derived>::success(Derived(std::forward<Args>(args)...));
        } catch (const std::exception& e) {
            return Result<Derived>::failure(e.what());
        }
    }
};
```

#### Checklist:
- [ ] Create factory pattern template
- [ ] Apply to all distributions
- [ ] Remove redundant factory code

### **Task 3: Rule of Five Template (~1,000 lines saved)**

#### Checklist:
- [ ] Create CRTP copy/move template
- [ ] Apply to all distributions
- [ ] Verify thread safety

### **Task 4: Cache Management Template (~750 lines saved)**

#### Checklist:
- [ ] Create cache management mixin (works with ThreadSafeCacheManager)
- [ ] Apply to all distributions
- [ ] Remove duplicate cache code

### **Task 5: Batch Operations Template (~1,500 lines saved)**

#### Checklist:
- [ ] Create batch kernel template
- [ ] Define distribution-specific kernels
- [ ] Apply to all distributions
- [ ] Preserve SIMD optimizations

### **Success Metrics:**
- [ ] 70% reduction in distribution code
- [ ] No performance regression
- [ ] Easier to add new distributions

---

## ‚ö° v0.9.4 - Mathematical Optimization & Polish (1-1.5 weeks)

### **Objective**
Optimize mathematical functions, eliminate magic numbers, standardize error handling, and achieve warning-free compilation.

### **Task 1: Mathematical Function Optimizations**

#### Fast Approximations
```cpp
namespace libstats::math::optimized {
    // Standard normal CDF using rational approximation
    double fast_normal_cdf(double x) {
        // Hart's approximation for |x| < 7.07
        if (std::abs(x) < 7.07) {
            const double a[] = {0.0705230784, 0.0422820123, 0.0092705272, 
                               0.0001520143, 0.0002765672, 0.0000430638};
            // Rational approximation implementation
        }
        return x > 0 ? 1.0 : 0.0;
    }
    
    // Stirling's approximation for log-gamma
    double fast_lgamma(double x) {
        if (x > 12.0) {  // Use Stirling for large values
            return (x - 0.5) * std::log(x) - x + 0.5 * std::log(2 * M_PI) +
                   1.0/(12.0*x) - 1.0/(360.0*x*x*x);
        }
        return std::lgamma(x);  // Fall back to standard for small values
    }
}
```

#### Algorithm Selection Thresholds
```cpp
namespace constants::math::algorithms {
    // Replace magic numbers with named constants
    inline constexpr double ERF_PADE_THRESHOLD = 3.5;
    inline constexpr double STIRLING_THRESHOLD = 12.0;
    inline constexpr double CONTINUED_FRACTION_THRESHOLD = 1.5;
    inline constexpr double BOX_MULLER_CACHE_SIZE = 1024;
    
    // Poisson algorithm selection
    inline constexpr double POISSON_KNUTH_THRESHOLD = 30.0;
    inline constexpr double POISSON_RATIO_THRESHOLD = 100.0;
    inline constexpr double POISSON_TRANSFORM_THRESHOLD = 1000.0;
}
```

#### Checklist:
- [ ] Implement fast approximations for common cases
- [ ] Add SIMD-friendly polynomial evaluations
- [ ] Implement branch-free algorithms where possible
- [ ] Add Kahan summation for series computations
- [ ] Document all algorithm selection thresholds

### **Task 2: Magic Numbers Elimination**

#### Distribution-Specific Constants
- [ ] **GaussianDistribution**:
  - [ ] Error function approximation constants
  - [ ] Box-Muller sampling constants
  - [ ] Tolerance values ‚Üí `constants::precision::*`
  
- [ ] **PoissonDistribution**:
  - [ ] Factorial approximation limits
  - [ ] Stirling approximation constants
  - [ ] Algorithm selection thresholds
  
- [ ] **GammaDistribution**:
  - [ ] Gamma function approximation constants
  - [ ] Shape parameter thresholds
  - [ ] Lanczos coefficients

- [ ] **ExponentialDistribution**:
  - [ ] Exponential approximation thresholds
  - [ ] Numerical stability constants

- [ ] **UniformDistribution**:
  - [ ] Range validation constants
  - [ ] Floating-point precision limits

- [ ] **DiscreteDistribution**:
  - [ ] Integer operation thresholds
  - [ ] Probability normalization constants

### **Task 3: Error Handling Standardization**

Create `include/core/error_handling.h`:
```cpp
namespace libstats::core {
    enum class ErrorCategory {
        InvalidParameter,
        NumericalInstability,
        ComputationOverflow,
        ConfigurationError
    };
    
    struct ErrorInfo {
        ErrorCategory category;
        std::string message;
        std::string context;
        std::optional<double> problematic_value;
        std::string suggested_action;
    };
    
    template<typename T>
    using Result = std::expected<T, ErrorInfo>;
}
```

#### Checklist:
- [ ] Define standardized error categories
- [ ] Update all distributions with consistent error handling
- [ ] Add numerical edge case protection
- [ ] Create standardized error messages
- [ ] Add comprehensive error handling tests

### **Task 4: Cross-Compiler Warning Cleanup**

#### Compiler-Specific Flags
- [ ] **Clang/AppleClang**: Build with `-Wall -Wextra -Wpedantic`
- [ ] **GCC**: Build with `-Wall -Wextra -Wpedantic -Wconversion`
- [ ] **MSVC**: Build with `/W4`

#### Checklist:
- [ ] Fix all template-related warnings
- [ ] Resolve conversion warnings
- [ ] Fix shadowing warnings
- [ ] Address unused variable warnings
- [ ] Ensure C++20 compatibility

### **Task 5: Architecture-Dependent Tuning**

From pre_V1_optimization_list.md:
- [ ] MIN_ELEMENTS_FOR_PARALLEL thresholds per architecture
- [ ] Adaptive grain sizes for CPU architectures
- [ ] SIMD crossover points for operations
- [ ] Thread pool sizing heuristics

### **Success Metrics:**
- [ ] Zero compiler warnings across all platforms
- [ ] All magic numbers replaced with named constants
- [ ] Measurable performance improvement in math functions
- [ ] Consistent error handling across all distributions

---

## üéØ v1.0.0 - Release Candidate & API Finalization (1 week)

### **Objective**
Finalize API, ensure production readiness, and prepare for release.

### **Task 1: API Export & Symbol Visibility**

Create `include/libstats_export.h`:
```cpp
#ifdef LIBSTATS_SHARED_LIBRARY
  #ifdef _WIN32
    #ifdef LIBSTATS_BUILDING
      #define LIBSTATS_API __declspec(dllexport)
    #else
      #define LIBSTATS_API __declspec(dllimport)
    #endif
  #else
    #define LIBSTATS_API __attribute__((visibility("default")))
  #endif
#else
  #define LIBSTATS_API
#endif
```

#### Checklist:
- [ ] Configure symbol visibility for shared libraries
- [ ] Add LIBSTATS_API macros to all public interfaces
- [ ] Implement inline namespace versioning
- [ ] Ensure ABI stability with PIMPL

### **Task 2: Package Configuration**

#### CMake Package Files
- [ ] Create CMake config files
- [ ] Generate pkg-config `.pc` file
- [ ] Support both header-only and compiled modes
- [ ] Add version compatibility checks

#### Package Manager Support
- [ ] Create vcpkg port file
- [ ] Create Conan recipe
- [ ] Test installation on clean systems

### **Task 3: Statistical Methods Consolidation**

From pre_V1_optimization_list.md - Extract to utility classes:
- [ ] Kolmogorov-Smirnov tests
- [ ] Anderson-Darling tests
- [ ] Chi-squared tests
- [ ] Bootstrap confidence intervals
- [ ] Cross-validation methods
- [ ] Information criteria (AIC, BIC, AICc)

### **Task 4: Final Documentation**

#### Checklist:
- [ ] Review all public API documentation
- [ ] Create migration guide from v0.9.x
- [ ] Document thread-safety guarantees
- [ ] Add performance characteristics documentation
- [ ] Create comprehensive examples

### **Task 5: Integration Testing**

#### Checklist:
- [ ] Test consumer applications
- [ ] Cross-platform build validation
- [ ] Performance regression testing
- [ ] Memory leak detection
- [ ] API compatibility verification

### **Task 6: Release Preparation**

#### Checklist:
- [ ] Update version numbers
- [ ] Generate comprehensive changelog
- [ ] Verify license headers
- [ ] Create release notes
- [ ] Tag release candidate

### **Success Metrics:**
- [ ] Clean builds on all platforms
- [ ] All tests pass
- [ ] Documentation complete
- [ ] Package installation works
- [ ] No performance regressions

---

## üìä Overall Success Metrics

### Quantitative Goals:
- **Compilation Speed**: 20-35% improvement ‚úÖ
- **Code Reduction**: 70% less duplicated code (~5,600 lines) ‚úÖ
- **Performance**: No regression, math functions optimized ‚úÖ
- **Build Quality**: Zero warnings across all compilers ‚úÖ
- **Test Coverage**: >90% code coverage ‚úÖ

### Qualitative Goals:
- **Clean Architecture**: Template-based with clear separation ‚úÖ
- **Developer Experience**: Fast compilation, easy to extend ‚úÖ
- **Production Ready**: Proper CI/CD, packaging, documentation ‚úÖ
- **API Stability**: Well-defined, exported, versioned API ‚úÖ

---

## üìÅ Documents to Archive

After creating this roadmap, archive:
1. `v0.9.0_to_v1.0.0_roadmap.md` ‚Üí `archive/`
2. `v0.9.2_task_list.md` ‚Üí `archive/` (cache work abandoned)
3. `v0.9.2_header_reorg_addendum.md` ‚Üí `archive/` (incorporated here)
4. `v0.9.3_task_list.md` ‚Üí `archive/` (incorporated here)
5. `pre_V1_optimization_list.md` ‚Üí `archive/` (useful items incorporated)

---

## üöÄ Next Immediate Actions

1. **Complete**: ‚úÖ GitHub Actions CI/CD pipeline setup
2. **Complete**: ‚úÖ CI/CD and linting configuration 
3. **Ready to Merge**: v0.9.1.5-ci-cd-setup branch
4. **Next Step**: Begin v0.9.2 header optimization after merge
5. **Continuous**: Use CI to validate all changes

---

**Document Status:** ‚úÖ APPROVED FOR IMPLEMENTATION  
**Implementation Start:** Immediate (CI/CD setup)  
**Target Completion:** 5-7 weeks to v1.0.0  
**Next Review:** Weekly progress check-ins
